# 产品需求文档（PRD）—— 智能投研分析助手（MCP 服务）

## 1. 引言

### 1.1 项目背景与目标
为参加蓝耘科技挑战赛，打造一个符合 MCP 协议的智能投研分析助手服务，解决新手投资者面对复杂财报难以理解的问题，提供“自动化抓取 + 文档解析 + 通俗化综合财务健康分析”的一体化能力，降低信息门槛，提升决策效率。

### 1.2 目标用户画像
- 个人投资者/炒股新手
- 金融知识有限，难以快速消化冗长的公告与财报（PDF/HTML）
- 期望获得清晰、可信、通俗的财务健康解读

### 1.3 核心价值主张
将复杂的财务报告转化为通俗易懂、覆盖关键维度（收入、盈利、现金流、负债风险）的“综合财务健康分析”，帮助用户快速理解公司经营质量，辅助投资研究。

---

## 2. 功能需求

### 2.1 MVP 功能清单
- 输入：股票代码（可附带交易所/市场，如 CN/US）
- 处理：
  1) 自动定位并抓取该标的最新官方财报/公告链接（优先：季报、年报）
  2) 下载与解析文档（PDF/HTML），提取可分析文本
  3) 基于提取文本生成“综合财务健康分析”（通俗语言）
- 输出：以易懂文风呈现的财务健康解读（JSON + 纯文本）

### 2.2 用户故事
- 作为一名新手投资者，我希望仅需输入股票代码即可自动获得公司最新财报的通俗化综合财务健康分析，从而不用啃长篇财报也能快速把握经营情况与风险点。

### 2.3 功能规格（MVP 范围）
- “综合财务健康分析”覆盖四大维度：
  1) 收入表现（增长/下滑，可能原因）
  2) 盈利能力（净利润、毛利率、费用率趋势与变化）
  3) 现金流状况（经营现金流与利润的匹配度，是否“纸面利润”）
  4) 负债与风险水平（资产负债率、短期偿债指标的变化与可承受度）
- 数据来源：
  - 优先抓取官方渠道（示例：CN 市场可对接巨潮/交易所公告目录，US 市场可用 SEC EDGAR）
  - 初版允许用户直接提供 PDF URL 进行分析（兜底路径）
- AI 分析：
  - 默认采用规则/关键词与模板化归纳生成通俗化解读（离线可用）
  - 若存在可用 LLM API Key（环境变量），可切换调用 LLM 生成更高质量结果（可选增强）

---

## 3. 非功能性需求

### 3.1 易用性
- 输入尽量简单（股票代码 + 市场）
- 输出语气通俗、避免术语堆砌

### 3.2 可靠性
- 抓取模块需具备重试与容错（网络失败、结构变动）
- 解析模块对 PDF/HTML 异常具备降级与提示

### 3.3 性能
- 单标的分析在合理时间内完成（目标 10~30 秒以内，受网络与文档大小影响）

### 3.4 安全与合规
- 尊重目标站点 Robots 与使用条款
- 对潜在订阅型数据源遵守授权协议

---

## 4. 范围与限制

### 4.1 本期范围（MVP）
- 支持单期最新财报/公告的分析
- 提供 MCP 工具方法：一键端到端分析、分步抓取/解析/分析
- 提供资源读取：基于标的的最新报告元数据

### 4.2 暂不纳入
- 多期历史对比、可视化趋势
- 个股价格预测或交易建议
- 实时行情接入

### 4.3 假设与依赖
- 官方财报/公告可在线公开获取
- 解析以 PDF 为主（兼容 HTML）
- 可选 LLM Key（如 OPENAI_API_KEY）存在时进行增强

---

## 5. 初步 UI/UX 构想（可选）
- 控制台/命令式使用（通过 MCP 客户端或 IDE 集成触发）
- Web 最简页（后续迭代）：输入股票代码，返回卡片化分析摘要

---

## 6. 未来展望
- 多期对比与可视化趋势图（营收、利润、现金流、负债率）
- 行业横向对比与基准化
- 舆情/新闻与公告联动分析
- 模型化指标打分与红黑榜

---

## 7. MCP 接口设计（MVP）

### 7.1 工具（Tools）
1) analyze_symbol(symbol: str, market: str = "CN") -> AnalysisResult
   - 端到端：抓取最新报告 -> 下载解析 -> 生成综合财务健康分析
2) fetch_latest_report(symbol: str, market: str = "CN") -> ReportMeta
   - 仅抓取报告元数据（标题、日期、URL、来源）
3) extract_text_from_pdf(url: str) -> ExtractResult
   - 下载并解析 PDF，返回纯文本（附带页数/大小信息）
4) analyze_text(text: str) -> AnalysisResult
   - 对已给定文本进行通俗化综合财务健康分析（可用于用户自备内容）

### 7.2 资源（Resources）
- report://{symbol}[?market=CN]
  - 返回最新报告元数据（与工具2一致，提供资源型访问）

### 7.3 返回结构（示例）
```json
{
  "ok": true,
  "symbol": "600519",
  "market": "CN",
  "report": {
    "title": "2024年半年度报告",
    "date": "2024-08-30",
    "url": "https://.../pdf",
    "source": "CNINFO"
  },
  "analysis": {
    "summary": "整体收入保持增长，盈利能力略有承压...",
    "revenue": "...",
    "profitability": "...",
    "cashflow": "...",
    "debt": "...",
    "risk_notes": ["..."]
  }
}
```

---

## 8. 技术方案要点

- 架构：main.py 为 FastMCP 服务入口；按模块拆分 scraper / parser / analysis
- 抓取：提供 CN/US Provider 接口，优先实现 US(EDGAR) 与 PDF URL 直连兜底；CN 可先占位并提示后续开关
- 解析：pdfminer.six / pdfplumber（二选一，先选 pdfminer.six），HTML 解析使用 BeautifulSoup + lxml
- 重试与超时：httpx + tenacity
- 日志：标准 logging，便于问题定位
- LLM 可选：若存在 OPENAI_API_KEY 则走 LLM 路径，否则采用规则与模板生成通俗化摘要